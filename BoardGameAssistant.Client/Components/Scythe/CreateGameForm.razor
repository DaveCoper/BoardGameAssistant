@using BoardGameAssistant.ServiceContracts.Scythe
@using BoardGameAssistant.ServiceContracts.Scythe.Dto

@inject NavigationManager Navigation
@inject IScytheGameService ScytheGameService

<MudPaper Class="pa-4" Elevation="1">
    <EditForm Model="@Model" OnValidSubmit="SaveAsync">
        <DataAnnotationsValidator />

        <MudGrid>
            <MudItem xs="12" sm="8">
                <MudText Typo="Typo.h6">Create new Scythe game</MudText>
            </MudItem>
        </MudGrid>

        <MudGrid Class="mt-4" Spacing="3">
            <MudItem xs="12" sm="6">
                <MudTextField For="@(() => Model.Name)"
                              Label="Name"
                              @bind-Value="Model.Name" />
            </MudItem>

            <MudItem xs="12" sm="6">
                <MudDatePicker For="@(() => Model.Occurrence)"
                               Label="Game date"
                               @bind-Date="Model.Occurrence" />
            </MudItem>

            <MudItem xs="12" sm="6">
                <MudSwitch For="@(() => Model.HasWindGambitExpansion)"
                           Label="Windgambit"
                           @bind-Value="Model.HasWindGambitExpansion" />
            </MudItem>

            <MudItem xs="12" sm="6">
                <MudSwitch For="@(() => Model.HasInvadersFromAfarExpansion)"
                           Label="Invaders from afar"
                           @bind-Value="Model.HasInvadersFromAfarExpansion" />
            </MudItem>

            <MudItem xs="12" sm="6">
                <MudSwitch For="@(() => Model.HasRiseOfFenrisExpansion)"
                           Label="Rise of Fenris"
                           @bind-Value="Model.HasRiseOfFenrisExpansion" />
            </MudItem>

            <MudItem xs="12" sm="6">
                <MudSwitch For="@(() => Model.HasModularBoard)"
                           Label="Modular board"
                           @bind-Value="Model.HasModularBoard" />
            </MudItem>

            <MudItem xs="12">
                <MudButton Variant="Variant.Filled" Color="Color.Primary" ButtonType="ButtonType.Submit">
                    Save
                </MudButton>
            </MudItem>
        </MudGrid>
    </EditForm>
</MudPaper>

@code {
    private NewScytheGame Model { get; set; }

    CreateGameForm()
    {
        Model = new NewScytheGame
        {
            Name = $"Scythe {DateTime.Now:dd/MM/yyyy}",
            Occurrence = DateTime.Now,
            HasInvadersFromAfarExpansion = false,
            HasRiseOfFenrisExpansion = false,
            HasWindGambitExpansion = false,
            HasModularBoard = false,
        };
    }

    private async Task SaveAsync()
    {
        try
        {
            var game = await ScytheGameService.CreateGameAsync(this.Model);
            Navigation.NavigateTo($"/scythe/{game.Id}");
        }
        catch (Exception ex)
        {

        }
    }
}
